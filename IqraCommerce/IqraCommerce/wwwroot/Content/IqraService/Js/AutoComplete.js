(function(n,t,i){function b(n,t,i){if(i.clientX!=a||i.clientY!=v){if(a=i.clientX,v=i.clientY,n.Focused){if(n.Focused.DataIndex==t.DataIndex)return;n.Focused.elm.removeClass("selected")}n.Focused=t;n.Focused.elm.addClass("selected")}}function y(n,t){t.value=t[n.valuefield]+"";t.text=t[n.textfield]+"";var i=t;i.elm=$('<li class="k-item">'+t[n.textfield]+"<\/li>").click(function(){s(n,i);n.IsFirstTime=!1}).mouseover(function(t){b(n,i,t)}).data("model",i);n.ItemContainer.append(i.elm)}function e(n,t){var u,i,r;for(t&&n.ItemContainer.empty(),n.page.PageNumber=n.page.PageNumber||1,u=Math.min(n.page.PageNumber.mlt(n.page.PageSize),n.CurrentList.length),i=(n.page.PageNumber-1).mlt(n.page.PageSize);i<u;i++)r=n.CurrentList[i],r.DataIndex=i,y(n,r)}function p(n){n.Container.find(".k-input").val("");n.Selected&&n.Selected.elm.removeClass("selected");n.value=null;n.elm.val("")}function f(n,t){for(var u,i=0;i<n.data.length;i++)if(n.data[i][n.valuefield]==t){u=n.data[i];break}u?s(n,u):t?(n.page.filter=n.page.filter.where('itm=>itm.field !="'+n.textfield+'"'),n.page.filter.push({field:n.valuefield,value:t,Operation:0}),r.Load(n,!0,function(){n.IsSearching=!1;n.data.length>0?s(n,n.data[0]):(p(n),n.filter.value="a",c(n,""))}),n.page.filter.pop()):p(n)}function o(n){var t,i;if(u=n,n.IsOpened)return!1;l();n.IsOpened=!0;t=n.Container.width()-4;n.ItemTemplate.css({width:t+"px"}).find(".dropdown_item_container").css({width:t+"px"});n.ItemTemplate.slideToggle(100);i=n.Container.offset();i.top+=30;n.ItemTemplate.offset(i);n.Container.addClass("opened")}function s(n,t){t.elm||y(n,t);n.Container.find(".k-input").val(t[n.textfield]);t.elm.addClass("selected");n.Selected=n.Selected||{elm:{removeClass:function(){}}};n.Selected.elm.removeClass("selected");var i=n.Selected;n.Selected=t;n.Focused=t;n.CurrentList=[t];n.value=t[n.valuefield];n.ItemTemplate.hide();n.elm.val(n.value);i[n.valuefield]!=t[n.valuefield]&&n.change&&n.change.call(n,n.Selected,i);h(n);e(n,!0)}function c(n,t){if(n.filter.value!=t){n.IsOpened||o(n);n.IsLoading&&n.Caller&&n.Caller.abort();n.filter.value=t;var i=[];n.page.filter.each(function(){this.field!=n.filter.field&&i.push(this)});n.page.filter=i;t&&n.page.filter.push(n.filter);n.IsSearching=!0;r.Load(n,!0,function(){n.IsSearching=!1})}}function k(n,t,i){i.keyCode==13||i.which==13||i.keyCode>36&&i.keyCode<41||i.which>36&&i.which<41||(n.IsFirstTime=!1,n.SearchEvent&&clearTimeout(n.SearchEvent),n.SearchEvent=setTimeout(function(){c(n,t.trim())},250))}function w(n,t){if(t=t.trim(),!(n.Selected&&n.Selected[n.textfield]==t)&&n.data){var r=n.data.filter(function(i){return i[n.textfield].trim()===t});r.length?s(n,r[0]):(n.Container.find(".k-input").val(""),n.Selected&&n.Selected.elm.removeClass("selected"),n.value=null,n.elm.val(""),n.Selected&&(n.Selected=i,n.change&&n.change.call(n,n.Selected,null)),c(n))}}function d(n){n.CurrentList=n.CurrentList||[];n.SorIndex==2?(n.SorIndex=i,n.CurrentList=n.CurrentDefaultList):n.SorIndex==1?(n.SorIndex=2,n.CurrentList.orderBy("Name",!0)):(n.CurrentDefaultList=n.CurrentList,n.SorIndex=1,n.CurrentList=n.CurrentList.slice().orderBy("Name"));e(n,!0);o(n)}function g(){}function nt(n){var i,t;console.log(["options",n,n.add,n.grid]);(n.add||n.grid)&&(i=$('<div class="button_container row" style="padding: 5px 10px; border-top: 1px solid silver;"><\/div>'),n.ItemTemplate.find(".dropdown_item_container").append(i),typeof n.create=="function"&&(t=$('<a style="margin-bottom: 0px;padding: 3px 10px;border-radius: 3px;border-width: 1px;border-style: solid;" class="pull-right btn-round btn-default"><span class="glyphicon glyphicon-plus"><\/span> New<\/a>'),i.append(t),Global.Click(t,function(){h(n);n.create({onSaveSuccess:function(t){f(n,t.Id)}})})),n.grid&&(t=$('<a style="margin-bottom: 0px;padding: 3px 10px;border-radius: 3px;border-width: 1px;border-style: solid;" class="pull-left btn-round btn-default"><span class="glyphicon glyphicon-list"><\/span> List<\/a>'),i.append(t),r.List.Bind(n,t)))}function tt(t){t.width=t.width||t.elm.width();t.ItemTemplate=$('<div class="dropdown_item_template">').click(function(n){n.stopPropagation()});t.ItemTemplate.append('<div class="dropdown_item_container"><div class="k-list-scroller"><ul class="k-list k-reset"><\/ul><\/div><\/div>').css({width:t.width-4+"px"});t.ItemContainer=t.ItemTemplate.find("ul");$(document.body).append(t.ItemTemplate);g(t);nt(t);var i=$('<span class="k-widget k-dropdown k-header" title="" style="width: 100%"><span class="k-dropdown-wrap k-state-default"><input class="form-control k-input" style="max-height: 27px; width: 100%; padding: 0; color: inherit;" /><span class="k-select"><span class="k-icon k-i-arrow-s">select<\/span><\/span><\/span><\/span>').click(function(n){n.stopPropagation()});t.elm.after(i).hide().data("dropdown",t);i.find(".k-dropdown-wrap").click(function(){return o(t),!1});t.Inputs=i.find(".k-input").keyup(function(n){k(t,this.value,n);t.onkeyup&&t.onkeyup(n)}).blur(function(){var n=this;setTimeout(function(){w(t,n.value)},150)}).focus(function(){o(t)});Global.Click(i.find(".k-select"),d,t);t.Container=i;r.Models.push(t);n.Service.LoadMore.Bind(t)}function h(n){n.IsOpened=!1;n.ItemTemplate.hide();n.Container.removeClass("opened");console.log(["closeItem",n])}function l(n){r.Models.each(function(){this.IsOpened&&w(this,this.Container.find(".k-input").val());this.IsOpened=!1;this.ItemTemplate.hide();this.Container.removeClass("opened")});n||(Global.DropDown&&Global.DropDown.CloseAll&&Global.DropDown.CloseAll("AutoComplete"),Global.MultiSelect&&Global.MultiSelect.CloseAll&&Global.MultiSelect.CloseAll("AutoComplete"))}Global.Free();LazyLoading.LoadCss([IqraConfig.Url.Css.DropDown]);var r={Models:[]},u,a,v;(function(n){function t(n){var t,r,u,i,f;return(window.filterModelClientSIde={},t=[],r="item",n.page.filter=n.page.filter||[],n.page.filter.length>0?(n.page.filter.each(function(){filterModelClientSIde[this.field]=new RegExp(this.value,"i");r+=" && item."+this.field+".Contains(filterModelClientSIde."+this.field+")"}),u=new Function("item","return "+r),n.datasource.each(function(){u(this)&&t.push(this)})):t=n.datasource,n.page.SortBy&&(t=t.orderBy(n.page.SortBy,n.page.IsDescending)),i=n.page.PageSize*(n.page.PageNumber-1),f=i+n.page.PageSize,i>=t.length)?[]:t.slice(i,f)}n.Load=function(n,r,u){var f,o;n.onload&&n.onload(n);n.datasource?(r&&(n.page.PageNumber=1,n.AllLoaded=!1,n.CurrentList=[],n.Focused=i),n.data=t(n),n.data.length<n.page.PageSize&&(n.AllLoaded=!0),n.CurrentList=n.CurrentList.concat(n.data),e(n,r)):(n.Container.addClass("loading"),n.IsLoading=!0,f=Global.Copy({},n.page,!0),n.onpost=n.onpost||n.onrequest,n.onpost&&n.onpost(f),o=typeof n.url=="function"?n.url.call(n,f):n.url,n.Caller=Global.CallServer(o,function(t){n.ondatabinding&&n.ondatabinding.call(n,t);n.data=typeof t.each=="function"?t:t.Data;n.Container.removeClass("loading");n.IsLoading=!1;r&&(n.page.PageNumber=1,n.AllLoaded=!1,n.CurrentList=[],n.Focused=i);n.data.length<n.page.PageSize&&(n.AllLoaded=!0);n.CurrentList=n.CurrentList.concat(n.data);e(n,r);n.IsFirstTime&&n.elm.val()&&n.val(n.elm.val());u&&u(t);n.onloaded&&n.onloaded(t.Data,n)},function(){n.IsLoading=!1},f,"POST",null,!1))}})(r),function(){function n(){return'<div class=""><div class="formHeader empty_style row headerFormMenu"><div class="col-xs-10 empty_style"><h4 data-binding="title" class="widget-title auto_bind" style="margin: 5px;"> Item Selector <\/h4><\/div><div class="col-xs-2 empty_style" style="padding: 0px; margin: 0px;"><span class="pull-right button_container"><a class="button btn_cancel"><span style="left:-2px;" class="glyphicon glyphicon-remove"><\/span><\/a><\/span><\/div><\/div><div class="middleForm empty_style"><div role="form" class="form-horizontal smart-form middleForm"><div class="item_selector_grid"><\/div><div class="row"><div class="text-center formFooter FooterFormMenu"><button class="btn btn_save btn-white btn-default btn-round" type="button"><span class="glyphicon glyphicon-plus"><\/span> Add Items <\/button><button class="btn btn_cancel btn-white btn-default btn-round" type="button" style="margin-left: 10px;"><span class="glyphicon glyphicon-remove"><\/span> Cancel<\/button><\/div><\/div><\/div><\/div><\/div>'}function t(n){if(n.actions)return Global.Copy({title:{items:n.pagger&&n.pagger.items||IqraConfig.Grid.Pagger.PageSize,selected:n.page&&n.page.PageSize||IqraConfig.Grid.Pagger.Selected,showingInfo:n.page&&n.page.showingInfo||n.pagger&&n.pagger.showingInfo||"Showing {0} to {1}  of {2}  items"},items:n.actions,className:"action"},n.action||{})}function i(n,i,r){function u(t){var i=n.grid.valuefield||n.valuefield;if(r.selected===t){console.log(["grid.selected && grid.selected[field] === model[field]",r.selected,r.selected[i],t[i]]);return}r.selected&&r.selected.elm.removeClass("i-state-selected");r.selected=t;r.selected.elm=$(this);r.selected.elm.addClass("i-state-selected")}function e(t){Global.Click(t,u,this);var r=this;t.dblclick(function(){var t=n.grid.valuefield||n.valuefield;r[t]&&(i.Hide(),f(n,r[t]))})}Global.Grid.Bind(Global.Copy(Global.Copy({elm:i.View.find(".item_selector_grid"),url:n.grid.url,page:{PageNumber:1,PageSize:10,filter:n.grid.filter||[]},pagger:{showingInfo:"{0}-{1} of {2} Items"},Action:t(n.grid),Printable:!1},n.grid,!0),{elm:i.View.find(".item_selector_grid"),rowBound:e,oncomplete:function(t){r.gridModel=t;n.grid.oncomplete&&n.grid.oncomplete(t)}},!0))}this.Bind=function(t,r,u){var e,o={};setNonCapitalisation(t.grid);Global.Click(r,function(){h(t);o.selected=u;e?(e.Show(),o.gridModel&&o.gridModel.Reload()):(e=Global.Window.Bind(n,{width:"90%"}),e.View.find(".btn_cancel").click(function(){e&&e.Hide()}),Global.Click(e.View.find(".btn_save"),function(){if(o.selected){var n=t.grid.valuefield||t.valuefield;o.selected[n]&&(e.Hide(),f(t,o.selected[n]))}else alert("No item selected.")}),e.Show(),i(t,e,o))})}}.call(r.List={}),function(){function t(n){n.IsDropDownBind=!0;n.textfield=n.textfield||IqraConfig.AutoComplete.TextField||"Name";n.valuefield=n.valuefield||IqraConfig.AutoComplete.ValuField||"Id";n.operation=n.operation||IqraConfig.AutoComplete.Operation;n.page=n.page||Global.Copy({},IqraConfig.AutoComplete.Page);n.page.filter=n.page.filter||[];n.filter=n.filter||{field:n.textfield,operation:n.operation}}this.Bind=function(n){var u,i;if(n.elm.data("dropdown")){u=n.elm.data("dropdown");for(i in n)n[i.toLowerCase()]=n[i.toLowerCase()]||n[i];u.url=n.url;r.Load(u,!0,function(){n.IsSearching=!1})}else{for(i in n)n[i.toLowerCase()]=n[i.toLowerCase()]||n[i];t(n);tt(n);n.val=function(t){if(arguments.length<1)return n.value;t&&t[n.valuefield]?f(n,t[n.valuefield]):f(n,t);n.IsFirstTime=!0};n.GetData=function(){for(var t=0;t<n.CurrentList.length;t++)if(n.CurrentList[t][n.valuefield]===n.value)return n.CurrentList[t];return null};n.GetText=function(){for(var t=0;t<n.CurrentList.length;t++)if(n.CurrentList[t][n.valuefield]===n.value)return n.CurrentList[t][n.textfield];return""};n.GetList=function(){return n.CurrentList};n.Reload=function(){r.Load(n,!0,function(){n.IsSearching=!1})};n.Close=function(){h(n)};n.Enable=function(t){t===!1?n.DisabledModel?n.DisabledModel.show():(n.DisabledModel=$('<span class="drp_disabled"><\/span>'),n.Container.append(n.DisabledModel)):n.DisabledModel&&n.DisabledModel.hide()};n.data=[];n.IsFirstTime=!0;r.Load(n,!0,function(){n.IsSearching=!1});n.oncomplete&&n.oncomplete(n)}return n};n.CloseAll=function(){l(!0)},function(){this.Bind=function(n){n.ItemTemplate.find(".k-list-scroller").scroll(function(){!n.AllLoaded&&!n.IsLoading&&n.ItemContainer.height()-$(this).scrollTop()-$(this).scrollTop()-$(this).height()<60&&(n.SearchEvent&&clearTimeout(n.SearchEvent),n.SearchEvent=setTimeout(function(){n.page.PageNumber++;r.Load(n,!1,function(){n.IsSearching=!1})},150))})}}.call(this.LoadMore={})}.call(n.Service={}),function(){function f(n){n.CurrentList.length<1||n.Focused&&(n.Focused.elm.removeClass("selected"),n.Focused.elm.click())}function e(n){var t=n.Focused.elm.offset().top-n.ItemTemplate.offset().top;if(min=n.ItemTemplate.find(".k-list-scroller").scrollTop(),height=n.ItemTemplate.height(),t<0){n.ItemTemplate.find(".k-list-scroller").scrollTop(min+t);return}(t=t+n.Focused.elm.height())<height||(t+=min,n.ItemTemplate.find(".k-list-scroller").scrollTop(t-height))}function t(n,t){n.Focused=n.CurrentList[t];n.Focused.elm.addClass("selected");n.ItemTemplate.height()<n.ItemContainer.height()&&e(n)}function o(n){if(!(n.CurrentList.length<1)){var i=0;if(n.Focused){if(i=n.Focused.DataIndex-1,i<0&&(i=0),i==n.Focused.DataIndex)return;n.Focused.elm.removeClass("selected")}t(n,i)}}function s(n){if(!(n.CurrentList.length<1)){var i=0;if(n.Focused){if(i=n.Focused.DataIndex+1,i>=n.CurrentList.length&&(i=n.CurrentList.length-1),i==n.Focused.DataIndex)return;n.Focused.elm.removeClass("selected")}t(n,i)}}function r(t){n&&n(t)}var n;$(document).click(function(){l()});$(document).keyup(function(t){u&&u.IsOpened&&((t.keyCode==13||t.which==13)&&f(u),n=i)});$(document).keydown(function(t){u&&u.IsOpened&&(t.keyCode==38||t.which==38?(n=o,r(u)):(t.keyCode==40||t.which==40)&&(n=s,r(u)))})}.call(r.Events={})})(Global.AutoComplete,function(){})