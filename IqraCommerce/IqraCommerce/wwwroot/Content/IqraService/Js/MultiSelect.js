(function(n,t,i){function c(n,t){t.value=t[n.valuefield]+"";t.text=t[n.textfield]+"";var i=t;i.elm=$('<li class="k-item'+(n.selectedDic[t[n.valuefield]]?" selected":"")+'"><input'+(n.selectedDic[t[n.valuefield]]?' checked="checked"':"")+' type="checkbox"> <span> '+t[n.textfield]+"<\/span><\/li>").click(function(){o(n,i)}).data("model",i);n.ItemContainer.append(i.elm)}function f(n,t){var r,i,u;for(t&&n.ItemContainer.empty(),n.page.PageNumber=n.page.PageNumber||1,r=Math.min(n.page.PageNumber.mlt(n.page.PageSize),n.CurrentList.length),i=(n.page.PageNumber-1).mlt(n.page.PageSize);i<r;i++)u=n.CurrentList[i],c(n,u)}function l(n,t){for(var u,i=0;i<n.data.length;i++)if(n.data[i][n.valuefield]==t){u=n.data[i];break}u?o(n,u):t?(n.page.filter=n.page.filter.where('itm=>itm.field !="'+n.textfield+'"'),n.page.filter.push({field:n.valuefield,value:t,Operation:0}),r.Load(n,!0,function(){n.IsSearching=!1;n.data.length>0?o(n,n.data[0]):setEmptyValue(n)}),n.page.filter.pop()):setEmptyValue(n)}function e(n){var t,i;if(n.IsOpened)return!1;h();n.IsOpened=!0;t=n.Container.width()-4;n.ItemTemplate.css({width:t+"px"}).find(".dropdown_item_container").css({width:t+"px"});n.ItemTemplate.slideToggle(100);i=n.Container.offset();i.top+=30;n.ItemTemplate.offset(i);n.Container.addClass("opened");n.Container.find(".k-input").val()==n.TotalSelectedItems&&n.Container.find(".k-input").val("")}function o(n,t){t.selected=!t.selected;t.elm||c(n,t);var i=[];n.selectedValues=[];n.selected.each(function(){this[n.valuefield]!=t[n.valuefield]&&(i.push(this),n.selectedValues.push(this[n.valuefield]))});n.selected=n.selected.where("itm=>itm."+n.valuefield+" != '"+t[n.valuefield]+"'");t.selected?(n.selected.push(t),t.elm.addClass("selected").find("input").prop("checked",!0),n.selectedValues.push(t[n.valuefield]),n.selectedDic[t[n.valuefield]]=!0):(t.elm.removeClass("selected").find("input").prop("checked",!1),n.selectedDic[t[n.valuefield]]=!1);n.value=n.selectedValues.join(",");n.elm.val(n.value);n.change&&n.change.call(n,n.selectedValues,n.selected);n.TotalSelectedItems=n.selectedValues.length+" Items Selected"}function s(n,t,i){if(i||n.filter.value!=t||n.Inputs.val()!=t){n.IsLoading&&n.Caller&&n.Caller.abort();n.filter.value=t;var u=[];n.page.filter.each(function(){this.field!=n.filter.field&&u.push(this)});Global.Copy(n.page.filter,u,!0);n.page.filter.length=u.length;t&&n.page.filter.push(n.filter);n.IsSearching=!0;r.Load(n,!0,function(){n.IsSearching=!1})}}function a(n,t){n.SearchEvent&&clearTimeout(n.SearchEvent);n.SearchEvent=setTimeout(function(){s(n,t.trim())},150)}function v(n){n.CurrentList=n.CurrentList||[];n.SorIndex==2?(n.SorIndex=i,n.CurrentList=n.CurrentDefaultList):n.SorIndex==1?(n.SorIndex=2,n.CurrentList.orderBy("Name",!0)):(n.CurrentDefaultList=n.CurrentList,n.SorIndex=1,n.CurrentList=n.CurrentList.slice().orderBy("Name"));f(n,!0);e(n)}function y(t){t.width=t.width||t.elm.width();t.ItemTemplate=$('<div class="dropdown_item_template">').click(function(n){n.stopPropagation()});t.ItemTemplate.append('<div class="dropdown_item_container"><div class="k-list-header"><a class="btn_search_list active glyphicon glyphicon-search" title="Search List"><\/a><a class="btn_clear glyphicon glyphicon-trash" title="Clear"><\/a><a class="btn_selected_list glyphicon glyphicon-th-list" title="Selected List"><\/a><\/div><div class="k-list-scroller"><ul class="k-list k-reset"><\/ul><\/div><div class="k-list-footer"><label class="auto_bind" data-binding="TotalSelectedItems"><\/label><\/div><\/div>').css({width:t.width-4+"px"});t.ItemContainer=t.ItemTemplate.find("ul");Global.Form.Bind(t,t.ItemTemplate.find(".k-list-footer"));$(document.body).append(t.ItemTemplate);u.Events.Bind(t);var i=$('<span class="k-widget k-dropdown k-header" title="" style="width: 100%"><span class="k-dropdown-wrap k-state-default"><input class="form-control k-input" style="max-height: 27px; width: 100%; padding: 0; color: inherit;" /><span class="k-select"><span class="k-icon k-i-arrow-s">select<\/span><\/span><\/span><\/span>').click(function(n){n.stopPropagation()});t.elm.after(i).hide().data("dropdown",t);i.find(".k-dropdown-wrap").click(function(){return e(t),!1});t.Inputs=i.find(".k-input").keyup(function(){return a(t,this.value),!1}).focus(function(){this.value==t.TotalSelectedItems&&(this.value="");e(t)});Global.Click(i.find(".k-select"),v,t);t.Container=i;r.Models.push(t);n.Service.LoadMore.Bind(t)}function h(n){r.Models.each(function(){this.IsOpened=!1;this.ItemTemplate.hide();this.Container.removeClass("opened");this.Container.find(".k-input").val(this.TotalSelectedItems)});n||(Global.DropDown&&Global.DropDown.CloseAll&&Global.DropDown.CloseAll("MultiSelect"),Global.AutoComplete&&Global.AutoComplete.CloseAll&&Global.AutoComplete.CloseAll("MultiSelect"))}Global.Free();LazyLoading.LoadCss([IqraConfig.Url.Css.DropDown]);var r={Models:[]},u={};(function(n){function t(n){var t,i,u,r,f;return(window.filterModelClientSIde={},t=[],i="item",n.page.filter=n.page.filter||[],n.page.filter.length>0?(n.page.filter.each(function(){filterModelClientSIde[this.field]=new RegExp(this.value,"i");i+=" && item."+this.field+".Contains(filterModelClientSIde."+this.field+")"}),console.log(["exp",i,n]),u=new Function("item","return "+i),n.datasource.each(function(){u(this)&&t.push(this)})):t=n.datasource,n.page.SortBy&&(t=t.orderBy(n.page.SortBy,n.page.IsDescending)),r=n.page.PageSize*(n.page.PageNumber-1),f=r+n.page.PageSize,r>=t.length)?[]:t.slice(r,f)}n.Load=function(n,i,r){var u,e;n.onload&&n.onload(n);n.datasource?(i&&(n.page.PageNumber=1,n.AllLoaded=!1,n.CurrentList=[]),n.data=t(n),n.data.length<n.page.PageSize&&(n.AllLoaded=!0),n.CurrentList=n.CurrentList.concat(n.data),f(n,i)):(n.Container.addClass("loading"),n.IsLoading=!0,u=Global.Copy({},n.page,!0),n.onpost&&n.onpost(u),e=typeof n.url=="function"?n.url.call(n,u):n.url,n.Caller=Global.CallServer(e,function(t){n.ondatabinding&&n.ondatabinding.call(n,t);n.data=typeof t.each=="function"?t:t.Data;n.Container.removeClass("loading");n.IsLoading=!1;i&&(n.page.PageNumber=1,n.AllLoaded=!1,n.CurrentList=[]);n.data.length<n.page.PageSize&&(n.AllLoaded=!0);n.CurrentList=n.CurrentList.concat(n.data);f(n,i);r&&r(t);n.onloaded&&n.onloaded(t.Data,n)},function(){n.IsLoading=!1},u,"POST",null,!1))}})(r),function(){function t(n){n.textfield=n.textfield||IqraConfig.MultiSelect.TextField;n.valuefield=n.valuefield||IqraConfig.MultiSelect.ValuField;n.page=n.page||Global.Copy({},IqraConfig.MultiSelect.Page);n.page.filter=n.page.filter||[];n.filter=n.filter||{field:n.textfield,operation:IqraConfig.MultiSelect.Operation};n.notFilter={field:n.valuefield,operation:13};n.selected=n.selected||[];n.selectedDic={};n.selected.each(function(){n.selectedDic[this[n.valuefield]||this+""]=!0});n.selectedValues=[];console.log(["Global.MultiSelect=>",n])}this.Bind=function(n){var f,i;if(n.elm.data("MultiSelect")){f=n.elm.data("MultiSelect");for(i in n)n[i.toLowerCase()]=n[i.toLowerCase()]||n[i];f.url=n.url;r.Load(f,!0,function(){n.IsSearching=!1})}else{for(i in n)n[i.toLowerCase()]=n[i.toLowerCase()]||n[i];t(n);n.IsDropDownBind=!0;y(n);n.val=function(t){if(arguments.length<1)return n.value;t&&t[n.valuefield]?l(n,t[n.valuefield]):l(n,t)};n.GetData=function(){for(var t=0;t<n.CurrentList.length;t++)if(n.CurrentList[t][n.valuefield]===n.value)return n.CurrentList[t];return null};n.GetText=function(){for(var t=0;t<n.CurrentList.length;t++)if(n.CurrentList[t][n.valuefield]===n.value)return n.CurrentList[t][n.textfield];return""};n.GetList=function(){return n.CurrentList};console.log(["options called ",n]);n.Reload=function(){r.Load(n,!0,function(){n.IsSearching=!1})};n.Clear=function(){u.Events.Clear(n)};n.Enable=function(t){t===!1?n.DisabledModel?n.DisabledModel.show():(n.DisabledModel=$('<span class="drp_disabled"><\/span>'),n.Container.append(n.DisabledModel)):n.DisabledModel&&n.DisabledModel.hide()};n.data=[];r.Load(n,!0,function(){n.IsSearching=!1});n.oncomplete&&n.oncomplete(n);console.log(["options.oncomplete",n])}return n};n.CloseAll=function(){h(!0)},function(){this.Bind=function(n){n.ItemTemplate.find(".k-list-scroller").scroll(function(){!n.AllLoaded&&!n.IsLoading&&n.ItemContainer.height()-$(this).scrollTop()-$(this).scrollTop()-$(this).height()<60&&(n.SearchEvent&&clearTimeout(n.SearchEvent),n.SearchEvent=setTimeout(function(){n.page.PageNumber++;r.Load(n,!1,function(){n.IsSearching=!1})},150))})}}.call(this.LoadMore={})}.call(n.Service={}),function(){function n(n){console.log(["setEmptyValue",n]);n.selected.each(function(){this.selected=!1;this.elm.removeClass("selected").find("input").prop("checked",!1)});n.selectedValues=[];n.selected=[];n.selectedDic={};n.value="";n.elm.val(n.value);n.change&&n.change.call(n,n.selectedValues,n.selected);n.TotalSelectedItems="No Item Selected";n.Container.find(".k-input").val("");t(n)}function t(n){n.IsSelectedList&&(n.IsSelectedList=!1,n.datasource=n.orginalDataSource,n.page.PageNumber=1,n.Inputs.val(""),s(n,"",!0),n.Header.find(".btn_search_list").addClass("active"),n.Header.find(".btn_selected_list").removeClass("active"))}function i(n){n.IsSelectedList||(n.IsSelectedList=!0,n.orginalDataSource=n.datasource,n.datasource=n.selected,n.page.PageNumber=1,n.Inputs.val(""),s(n,"",!0),n.Header.find(".btn_search_list").removeClass("active"),n.Header.find(".btn_selected_list").addClass("active"))}function r(n){n.buttons.each(function(){var i,t;setNonCapitalisation(this);i="";i=this.html?this.html:'<a class="glyphicon glyphicon-'+(this.class||this.classname||"")+'" title="'+(this.title||"")+'">'+(this.text||"")+"<\/a>";t=$(i);n.Header.append(t);Global.Click(t,this.click,n,!1,t)})}this.Clear=n;this.Bind=function(u){u.Header=u.ItemTemplate.find(".k-list-header");Global.Click(u.Header.find(".btn_search_list"),t,u);Global.Click(u.Header.find(".btn_clear"),n,u);Global.Click(u.Header.find(".btn_selected_list"),i,u);u.buttons&&u.buttons.each&&r(u)}}.call(u.Events={});$(document).click(function(){h()})})(Global.MultiSelect,function(){})